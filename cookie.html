<!-- CHANGES ONLY in JavaScript: -->
<script>
function setupTouchDrag(chip) {
  let startX = 0, startY = 0, initialLeft = 0, initialTop = 0;

  chip.addEventListener('touchstart', function(event) {
    const touch = event.touches[0];
    const rect = chip.getBoundingClientRect();
    const parentRect = chip.parentElement.getBoundingClientRect();

    startX = touch.clientX;
    startY = touch.clientY;
    initialLeft = chip.offsetLeft;
    initialTop = chip.offsetTop;

    chip.style.transition = 'none';
  }, false);

  chip.addEventListener('touchmove', function(event) {
    event.preventDefault();
    const touch = event.touches[0];
    const deltaX = touch.clientX - startX;
    const deltaY = touch.clientY - startY;

    chip.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
  }, { passive: false });

  chip.addEventListener('touchend', function(event) {
    const touch = event.changedTouches[0];
    const cookieRect = cookie.getBoundingClientRect();
    const chipRect = chip.getBoundingClientRect();

    const chipCenterX = chipRect.left + chipRect.width / 2;
    const chipCenterY = chipRect.top + chipRect.height / 2;

    if (chipCenterX > cookieRect.left && chipCenterX < cookieRect.right &&
        chipCenterY > cookieRect.top && chipCenterY < cookieRect.bottom) {

      chip.style.transform = 'none';
      chip.style.position = 'absolute';
      chip.style.left = (chipCenterX - cookieRect.left - 20) + 'px';
      chip.style.top = (chipCenterY - cookieRect.top - 20) + 'px';
      cookie.appendChild(chip);

      remaining--;
      totalScore += 1000;
      updateScore();
      triggerCelebration();
      flashScoreBar();

      if (remaining === 0) {
        celebration.textContent = 'ðŸŽ‰ All Done! ðŸŽ‰';
        celebration.classList.add('show');
      }
    } else {
      chip.style.transform = 'none';
      chip.style.left = initialLeft + 'px';
      chip.style.top = initialTop + 'px';
    }
  }, false);
}
</script>